============================= test session starts =============================
platform win32 -- Python 3.11.9, pytest-8.0.0, pluggy-1.6.0
rootdir: D:\GitHub\Custom-Native-Compiler
collected 1 item

tests\unit\test_parser.py 
TOKENS: [Token(KW_VOID, 'void', 2:5), Token(IDENTIFIER, 'main', 2:10), Token(LPAREN, '(', 2:14), Token(RPAREN, ')', 2:15), Token(LBRACE, '{', 2:17), Token(KW_IF, 'if', 3:9), Token(LPAREN, '(', 3:12), Token(IDENTIFIER, 'x', 3:13), Token(GT, '>', 3:15), Token(INTEGER, '0', 3:17), Token(RPAREN, ')', 3:18), Token(LBRACE, '{', 3:20), Token(KW_PRINT, 'print', 4:13), Token(LPAREN, '(', 4:18), Token(IDENTIFIER, 'x', 4:19), Token(RPAREN, ')', 4:20), Token(SEMICOLON, ';', 4:21), Token(RBRACE, '}', 5:9), Token(KW_ELSE, 'else', 5:11), Token(LBRACE, '{', 5:16), Token(KW_RETURN, 'return', 6:13), Token(SEMICOLON, ';', 6:19), Token(RBRACE, '}', 7:9), Token(KW_WHILE, 'while', 8:9), Token(LPAREN, '(', 8:15), Token(IDENTIFIER, 'count', 8:16), Token(LT, '<', 8:22), Token(INTEGER, '10', 8:24), Token(RPAREN, ')', 8:26), Token(LBRACE, '{', 8:28), Token(IDENTIFIER, 'count', 9:13), Token(ASSIGN, '=', 9:19), Token(IDENTIFIER, 'count', 9:21), Token(PLUS, '+', 9:27), Token(INTEGER, '1', 9:29), Token(SEMICOLON, ';', 9:30), Token(RBRACE, '}', 10:9), Token(RBRACE, '}', 11:5), Token(EOF, '', 12:5)]
DEBUG: _match checking TokenType.KW_IF against (<TokenType.KW_IF: 12>,)
DEBUG: _match checking TokenType.IDENTIFIER against (<TokenType.NOT: 38>, <TokenType.MINUS: 24>)
DEBUG: parse_primary current=Token(IDENTIFIER, 'x', 3:13)
DEBUG: _match checking TokenType.IDENTIFIER against (<TokenType.INTEGER: 1>,)
DEBUG: _match checking TokenType.IDENTIFIER against (<TokenType.FLOAT: 2>,)
DEBUG: _match checking TokenType.IDENTIFIER against (<TokenType.KW_TRUE: 21>,)
DEBUG: _match checking TokenType.IDENTIFIER against (<TokenType.KW_FALSE: 22>,)
DEBUG: _match checking TokenType.IDENTIFIER against (<TokenType.IDENTIFIER: 3>,)
DEBUG: _match checking TokenType.GT against (<TokenType.LPAREN: 40>,)
DEBUG: _match checking TokenType.INTEGER against (<TokenType.NOT: 38>, <TokenType.MINUS: 24>)
DEBUG: parse_primary current=Token(INTEGER, '0', 3:17)
DEBUG: _match checking TokenType.INTEGER against (<TokenType.INTEGER: 1>,)
DEBUG: _match checking TokenType.RPAREN against (<TokenType.ASSIGN: 39>,)
DEBUG: _match checking TokenType.KW_PRINT against (<TokenType.KW_IF: 12>,)
DEBUG: _match checking TokenType.KW_PRINT against (<TokenType.KW_WHILE: 14>,)
DEBUG: _match checking TokenType.KW_PRINT against (<TokenType.KW_RETURN: 18>,)
DEBUG: _match checking TokenType.KW_PRINT against (<TokenType.NOT: 38>, <TokenType.MINUS: 24>)
DEBUG: parse_primary current=Token(KW_PRINT, 'print', 4:13)
DEBUG: _match checking TokenType.KW_PRINT against (<TokenType.INTEGER: 1>,)
DEBUG: _match checking TokenType.KW_PRINT against (<TokenType.FLOAT: 2>,)
DEBUG: _match checking TokenType.KW_PRINT against (<TokenType.KW_TRUE: 21>,)
DEBUG: _match checking TokenType.KW_PRINT against (<TokenType.KW_FALSE: 22>,)
DEBUG: _match checking TokenType.KW_PRINT against (<TokenType.IDENTIFIER: 3>,)
DEBUG: _match checking TokenType.KW_PRINT against (<TokenType.LPAREN: 40>,)
F

================================== FAILURES ===================================
______________________________ test_control_flow ______________________________

    def test_control_flow():
        source = """
        void main() {
            if (x > 0) {
                print(x);
            } else {
                return;
            }
            while (count < 10) {
                count = count + 1;
            }
        }
        """
        lexer = Lexer(source)
        tokens = lexer.tokenize()
        print(f"\nTOKENS: {tokens}")
>       ast_root = Parser(tokens).parse()

tests\unit\test_parser.py:62: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\frontend\parser.py:85: in parse
    declarations.append(self.parse_declaration())
src\frontend\parser.py:112: in parse_declaration
    return self.parse_function_decl(type_str, name_str)
src\frontend\parser.py:153: in parse_function_decl
    body = self.parse_block()
src\frontend\parser.py:161: in parse_block
    statements.append(self.parse_statement())
src\frontend\parser.py:172: in parse_statement
    return self.parse_if_statement()
src\frontend\parser.py:193: in parse_if_statement
    then_branch = self.parse_statement()
src\frontend\parser.py:170: in parse_statement
    return self.parse_block()
src\frontend\parser.py:161: in parse_block
    statements.append(self.parse_statement())
src\frontend\parser.py:185: in parse_statement
    return self.parse_expression_statement()
src\frontend\parser.py:219: in parse_expression_statement
    expr = self.parse_expression()
src\frontend\parser.py:227: in parse_expression
    return self.parse_assignment()
src\frontend\parser.py:231: in parse_assignment
    expr = self.parse_equality()
src\frontend\parser.py:246: in parse_equality
    return self._parse_binary(self.parse_relational, [TokenType.EQ, TokenType.NEQ])
src\frontend\parser.py:258: in _parse_binary
    expr = next_precedence_func()
src\frontend\parser.py:249: in parse_relational
    return self._parse_binary(self.parse_additive, [TokenType.LT, TokenType.GT, TokenType.LTE, TokenType.GTE])
src\frontend\parser.py:258: in _parse_binary
    expr = next_precedence_func()
src\frontend\parser.py:252: in parse_additive
    return self._parse_binary(self.parse_multiplicative, [TokenType.PLUS, TokenType.MINUS])
src\frontend\parser.py:258: in _parse_binary
    expr = next_precedence_func()
src\frontend\parser.py:255: in parse_multiplicative
    return self._parse_binary(self.parse_unary, [TokenType.STAR, TokenType.SLASH, TokenType.MODULO])
src\frontend\parser.py:258: in _parse_binary
    expr = next_precedence_func()
src\frontend\parser.py:270: in parse_unary
    return self.parse_call_or_primary()
src\frontend\parser.py:274: in parse_call_or_primary
    expr = self.parse_primary()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <src.frontend.parser.Parser object at 0x0000020E23674790>

    def parse_primary(self) -> ast.Expr:
        print(f"DEBUG: parse_primary current={self._current()}")
        if self._match(TokenType.INTEGER):
            return ast.Literal(int(self.tokens[self.pos-1].value), "int")
        if self._match(TokenType.FLOAT):
            return ast.Literal(float(self.tokens[self.pos-1].value), "float")
        if self._match(TokenType.KW_TRUE):
            return ast.Literal(True, "bool")
        if self._match(TokenType.KW_FALSE):
            return ast.Literal(False, "bool")
        if self._match(TokenType.IDENTIFIER):
            return ast.Variable(self.tokens[self.pos-1].value)
    
        if self._match(TokenType.LPAREN):
            expr = self.parse_expression()
            self._consume(TokenType.RPAREN, "Expected ')' after expression.")
            return expr
    
>       raise Exception(f"Expected expression at {self._current().line}:{self._current().column}, found {self._current().type}")
E       Exception: Expected expression at 4:13, found TokenType.KW_PRINT

src\frontend\parser.py:310: Exception
=========================== short test summary info ===========================
FAILED tests/unit/test_parser.py::test_control_flow - Exception: Expected exp...
============================== 1 failed in 0.07s ==============================
